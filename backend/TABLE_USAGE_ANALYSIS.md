# ãƒ†ãƒ¼ãƒ–ãƒ«ä½¿ç”¨çŠ¶æ³ã®åˆ†æ

## ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ

### âœ… ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¿…é ˆï¼‰

1. **customers** - é¡§å®¢æƒ…å ±
   - ä½¿ç”¨ç®‡æ‰€: `rpa/generic/supabase_client.py` (upsert_customer)
   - ç”¨é€”: æ±ç”¨RPAã§å–å¾—ã—ãŸé¡§å®¢æƒ…å ±ã‚’ä¿å­˜

2. **orders** - æ³¨æ–‡æƒ…å ±
   - ä½¿ç”¨ç®‡æ‰€: 
     - `rpa/generic/supabase_client.py` (upsert_order) - æ±ç”¨RPAç”¨
     - `rpa/utils/data_saver.py` (save_orders_to_supabase) - ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰RPAç”¨
   - ç”¨é€”: æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜

3. **order_items** - æ³¨æ–‡å•†å“æƒ…å ±
   - ä½¿ç”¨ç®‡æ‰€: `rpa/generic/supabase_client.py` (upsert_order_items)
   - ç”¨é€”: æ³¨æ–‡ã«å«ã¾ã‚Œã‚‹å•†å“è©³ç´°ã‚’ä¿å­˜

### ğŸ“Š ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ï¼‰

1. **order_summary** - æ³¨æ–‡ã‚µãƒãƒªãƒ¼
2. **weekly_order_trend** - é€±é–“æ³¨æ–‡æ¨ç§»
3. **product_order_ratio** - å•†å“åˆ¥æ³¨æ–‡å‰²åˆ
4. **order_list_view** - æ³¨æ–‡ä¸€è¦§

## âš ï¸ æ³¨æ„ç‚¹

### 1. å¤ã„ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§

`rpa/utils/data_saver.py`ã®`save_orders_to_supabase`é–¢æ•°ã¯ã€å¤ã„ã‚¹ã‚­ãƒ¼ãƒæ§‹é€ ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ï¼š

```python
order_data = {
    "user_id": user_id,
    "platform": platform,
    "order_id": order.get("order_id", ""),
    "customer_name": order.get("customer", ""),  # â† customersãƒ†ãƒ¼ãƒ–ãƒ«ã«åˆ†é›¢ã™ã¹ã
    "total": order.get("total", ""),  # â† total_amountã«å¤‰æ›´ã™ã¹ã
    "job_id": job_id
}
```

**å•é¡Œç‚¹:**
- `customer_name`ã‚’ç›´æ¥`orders`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹
- `total`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãŒ`total_amount`ã¨ä¸€è‡´ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹
- `order_date`ãŒå¿…é ˆã ãŒã€æä¾›ã•ã‚Œã¦ã„ãªã„å ´åˆãŒã‚ã‚‹

### 2. é‡è¤‡ã™ã‚‹SQLãƒ•ã‚¡ã‚¤ãƒ«

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ãŒã€**`supabase_schema.sql`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„**ï¼š

- âŒ `rpa/generic/create_tables.sql` - å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆplatform, user_id, job_id, unitã‚«ãƒ©ãƒ ãŒãªã„ï¼‰
- âœ… `supabase_schema.sql` - æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’å«ã‚€ï¼‰

## ğŸ”§ æ¨å¥¨ã•ã‚Œã‚‹å¯¾å¿œ

### 1. å¤ã„ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°

`rpa/utils/data_saver.py`ã‚’æ–°ã—ã„ã‚¹ã‚­ãƒ¼ãƒæ§‹é€ ã«åˆã‚ã›ã¦æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 2. ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

`rpa/generic/create_tables.sql`ã¯å‰Šé™¤ã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼ˆ`supabase_schema.sql`ãŒæœ€æ–°ç‰ˆã§ã™ï¼‰ã€‚

## âœ… çµè«–

**ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å¿…è¦ã§ã™ã€‚** ãŸã ã—ã€ä»¥ä¸‹ã®å¯¾å¿œãŒå¿…è¦ã§ã™ï¼š

1. âœ… `customers`, `orders`, `order_items` - ã™ã¹ã¦å¿…è¦
2. âœ… 4ã¤ã®ãƒ“ãƒ¥ãƒ¼ - ã™ã¹ã¦å¿…è¦ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ï¼‰
3. âš ï¸ `rpa/utils/data_saver.py`ã®æ›´æ–°ãŒå¿…è¦
4. ğŸ—‘ï¸ `rpa/generic/create_tables.sql`ã¯å‰Šé™¤å¯èƒ½ï¼ˆå¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰

